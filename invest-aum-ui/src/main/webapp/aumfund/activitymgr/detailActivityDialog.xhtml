<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui">

    <ui:composition>
        <p:dialog id="MgSetDetailCreateDlg" widgetVar="MgSetDetailCreateDialog" modal="true" resizable="false" appendTo="@(body)" header="管理費子活動案設定" width="1200px">
            <h:form id="MgSetDetailCreateForm" prependId="false">
                <p:messages id="dlgMsg" autoUpdate="true"/>
                <p:scrollPanel mode="native" style="width:1175px;height:500px" >
                    <p:panelGrid style="width: 95%"> 
                        <p:row>
                            <p:column styleClass="ui-widget-header" style="width: 110px">
                                <p:outputLabel value="主活動案" />
                            </p:column>
                            <p:column>
                                <p:selectOneMenu  id="mgActSetType" value="#{mgSetDetailController.mgSetDetail.mgSetMasterId}" disabled="#{mgSetDetailController.showReadonly()}">                                           
                                    <f:selectItem itemLabel="Select One" itemValue="" />             
                                    <f:selectItems value="#{mgSetDetailController.mgSetMasterList}" var="master" itemLabel="#{master.mgActMCode}-#{master.mgActMName}" itemValue="#{master}" /> 
                                    <p:ajax  event="change" update=":MgSetDetailCreateForm:mgActDCode" />
                                </p:selectOneMenu>                         
                            </p:column>
                        </p:row>

                        <p:row>
                            <p:column styleClass="ui-widget-header">
                                <p:outputLabel value="子活動案代碼" for="mgActDCode" />
                            </p:column>
                            <p:column>
                                <p:outputLabel id="mgActDCode" value="#{mgSetDetailController.mgSetDetail.mgSetMasterId.mgActMChargeObj}#{mgSetDetailController.mgSetDetail.mgSetMasterId.mgActMCode}#{mgSetDetailController.showMgSetDetailCode()}" 
                                               title="#{bundle.CreateMgSetDetailTitle_mgActDCode}"/>                          
                            </p:column>
                        </p:row>                       

                        <p:row>
                            <p:column styleClass="ui-widget-header">
                                <p:outputLabel value="子活動案名稱" for="mgActDName" />
                            </p:column>
                            <p:column>
                                <p:inputText size="50" id="mgActDName" value="#{mgSetDetailController.mgSetDetail.mgActDName}" title="#{bundle.CreateMgSetDetailTitle_mgActDName}" disabled="#{mgSetDetailController.showReadonly()}">       
                                    <f:validateLength maximum="50" />
                                <p:ajax update="dlgMsg" event="blur" />
                                </p:inputText>
                            </p:column>                            
                        </p:row>

                        <p:row>
                            <p:column styleClass="ui-widget-header">
                                <p:outputLabel value="活動期間" for="mgActDStartDate" />
                            </p:column>
                            <p:column>
                                <p:calendar pattern="yyyyMMdd" id="mgActDStartDate" value="#{mgSetDetailController.mgSetActDetailStartDate}" 
                                            title="#{bundle.CreateMgSetDetailTitle_mgActDStartDate}" disabled="#{mgSetDetailController.showReadonly()}">
                                    <f:convertDateTime type="date"  dateStyle="short" pattern="yyyyMMdd" />
                                </p:calendar>
                                ~
                                <p:calendar pattern="yyyyMMdd"  id="mgActDEndDate" value="#{mgSetDetailController.mgSetActDetailEndDate}" title="#{bundle.CreateMgSetDetailTitle_mgActDEndDate}" disabled="#{mgSetDetailController.showReadonly()}">
                                    <f:convertDateTime type="date"  dateStyle="short" pattern="yyyyMMdd" />
                                </p:calendar>
                            </p:column>
                        </p:row>
                        <p:row>
                            <p:column styleClass="ui-widget-header">
                                <p:outputLabel value="適用通路" for="mgActDSaleChnl" />
                            </p:column>
                            <p:column>                                    
                                <p:selectCheckboxMenu label="Channel" id="mgActDSaleChnl" value="#{mgSetDetailController.selectedChannel}" multiple="true" disabled="#{mgSetDetailController.showReadonly()}">
                                    <f:selectItem itemLabel="ALL" itemValue="9" />
                                    <f:selectItem itemLabel="臨櫃" itemValue="1" />
                                    <f:selectItem itemLabel="網路" itemValue="2" />
                                    <f:selectItem itemLabel="語音" itemValue="3" />
                                    <f:selectItem itemLabel="電話下單" itemValue="4" />
                                    <f:selectItem itemLabel="Phone Banking" itemValue="5" />
                                    <f:selectItem itemLabel="KOKO" itemValue="6" />
                                    <f:selectItem itemLabel="ROBO" itemValue="7" />
                                    <p:ajax event="change" update="mgActDPrdCode mgActDSecType mgActDRemark" listener="#{mgSetDetailController.autoFill()}"  />
                                </p:selectCheckboxMenu>
                            </p:column>
                        </p:row>                       

                        <p:row>
                            <p:column styleClass="ui-widget-header">
                                <p:outputLabel value="適用產品代碼" for="mgActDPrdCode" />  
                            </p:column>
                            <p:column>
                                <!--<p:inputText id="mgActDPrdCode" value="#{mgSetDetailController.mgSetDetail.mgActDPrdCode}" title="#{bundle.CreateMgSetDetailTitle_mgActDPrdCode}" />-->
                                <p:outputPanel id="mgActDPrdCodePanel" style="margin-bottom:10px">
                                    <p:selectOneRadio id="mgActDPrdCode" value="#{mgSetDetailController.mgSetDetail.mgActDPrdCode}"  layout="custom" disabled="#{mgSetDetailController.showReadonly()}">
                                        <f:selectItem itemLabel="ALL" itemValue="1" />
                                        <f:selectItem itemLabel="系列代碼" itemValue="2" />
                                        <f:selectItem itemLabel="產品類型" itemValue="3" />
                                        <f:selectItem itemLabel="自定" itemValue="4" />
                                    </p:selectOneRadio>
                                    <h:panelGrid columns="11" cellpadding="5">
                                        <p:radioButton id="mgActDPrdCodeopt0" for="mgActDPrdCode" itemIndex="0" />
                                        <h:outputLabel for="mgActDPrdCodeopt0" value="ALL" />

                                        <p:radioButton id="mgActDPrdCodeopt1" for="mgActDPrdCode" itemIndex="1" />
                                        <h:outputLabel for="mgActDPrdCodeopt1" value="系列代碼" />
                                        <p:commandButton value="設定"/>

                                        <p:radioButton id="mgActDPrdCodeopt2" for="mgActDPrdCode" itemIndex="2" />
                                        <h:outputLabel for="mgActDPrdCodeopt2" value="產品類型" />
                                        <p:commandButton value="設定"/>

                                        <p:radioButton id="mgActDPrdCodeopt3" for="mgActDPrdCode" itemIndex="3" />
                                        <h:outputLabel for="mgActDPrdCodeopt3" value="自定" />
                                        <p:commandButton value="設定" actionListener="#{mgSetDetailController.preSetting()}" update="MgSetProductSettingForm" 
                                                         onclick="PF('MgSetProductSettingDialog').show()"/>
                                    </h:panelGrid>
                                </p:outputPanel>
                            </p:column>
                        </p:row>
                        <p:row>
                            <p:column styleClass="ui-widget-header">
                                <p:outputLabel value="資產總額計算方式" for="mgActDSecType" />  
                            </p:column>
                            <p:column>
                                <p:outputPanel id="mgActDSecTypePanel" style="margin-bottom:10px">

                                    <h:panelGrid columns="2" cellpadding="5">
                                        <p:selectOneMenu id="mgActDSecType" value="#{mgSetDetailController.mgSetDetail.mgActDSecType}" disabled="#{mgSetDetailController.showReadonly()}" >
                                            <p:ajax update="mgActDSecTypePanel"  />
                                            <f:selectItem itemLabel="客戶ID" itemValue="1" />
                                            <f:selectItem itemLabel="單一標的" itemValue="2" />
                                            <f:selectItem itemLabel="系列代碼" itemValue="3" />
                                            <f:selectItem itemLabel="產品類型" itemValue="4" />
                                            <f:selectItem itemLabel="自訂" itemValue="5" />          
                                        </p:selectOneMenu>
                                        <p:commandButton id="btnMgActDSecType" value="設定"  disabled="#{mgSetDetailController.showReadonly()}">
                                            <f:param name="mgActDSecType" value="#{mgSetDetailController.mgSetDetail.mgActDSecType}" />
                                        </p:commandButton>

                                    </h:panelGrid>
                                </p:outputPanel> 
                            </p:column>
                        </p:row>

                        <p:row>
                            <p:column styleClass="ui-widget-header">
                                <p:outputLabel value="費率規則"  />  
                            </p:column>
                            <p:column>
                                <p:selectOneRadio id="mgActDRemark" value="#{mgSetDetailController.mgSetDetail.mgActDRemark}" disabled="#{mgSetDetailController.showReadonly()}">
                                    <f:selectItem itemLabel="級距式費率" itemValue="1" />
                                    <f:selectItem itemLabel="累進式費率" itemValue="2" />
                                </p:selectOneRadio>
                                <p:tooltip id="toolTipFocus" for="mgActDRemark" value="勾選後計算方式採分層計算，e.g. AUM總計20E，其中15E採10bps計算，15.1E~20E採20bps計算。"/>
                            </p:column>
                        </p:row>
                        <p:row>
                            <p:column styleClass="ui-widget-header">
                                <p:outputLabel value="適用客群" for="mgActDCostId" />
                            </p:column>
                            <p:column>
                                <p:selectOneRadio id="mgActDCostId" value="#{mgSetDetailController.mgSetDetail.mgActDCostId}" disabled="#{mgSetDetailController.showReadonly()}">
                                    <f:selectItem itemLabel="ALL" itemValue="1" />
                                    <f:selectItem itemLabel="名單" itemValue="2" />                                       
                                </p:selectOneRadio>
                                <p:spacer width="5"/>
                                <p:commandButton value="IDN上傳設定" icon="ui-icon-plus" 
                                                 actionListener="#{mgSetDetailController.prepareIdn}" 
                                                 update=":MgCustActListForm" oncomplete="PF('MgCustActListDlg').show()"
                                                 rendered="#{mgSetDetailController.showReadonly()}" />
                            </p:column>
                        </p:row>
                    </p:panelGrid>


                    <p:fieldset legend="級距設定">
                        <p:selectBooleanCheckbox value="#{mgSetDetailController.mgActMgRtnRateFlag}"  disabled="#{mgSetDetailController.showReadonly()}">
                            <p:ajax update="datalist"/>
                        </p:selectBooleanCheckbox>
                    <p:spacer width="5"/>
                    <h:outputText value="依對應管理費計算" />

                    <p:dataTable id="datalist" 
                                 value="#{mgSetDetailController.rangeList}" var="item"
                                 paginator="true"                                            
                                 rows="10"                         
                                 rowsPerPageTemplate="10,20,30,40,50"
                                 emptyMessage="查無資料"              
                                 paginatorPosition="bottom"
                                 >            

                        <f:facet name="header">
                            <p:commandButton process=":MgSetDetailCreateForm:datalist" icon="ui-icon-plus" value="新增級距" 
                                             actionListener="#{mgSetDetailController.addMSDRC()}" 
                                             update=":MgSetDetailCreateForm:datalist" disabled="#{mgSetDetailController.showReadonly()}"/>   
                        </f:facet>

                        <p:column>
                            <f:facet name="header">
                                <h:outputText value="幣別"/>
                            </f:facet>
                            <p:selectOneMenu value="#{item.mgActCurrency}" disabled="#{mgSetDetailController.showReadonly()}">
                                <f:selectItem itemLabel="TWD" itemValue="TWD" />
                                <f:selectItem itemLabel="USD" itemValue="USD" />
                                <f:selectItem itemLabel="EUR" itemValue="EUR" />
                            </p:selectOneMenu>
                        </p:column>
                        <p:column>
                            <f:facet name="header">
                                <h:outputText value="最低金額"/>
                            </f:facet>
                            <p:inputNumber size="15" value="#{item.mgActLowAmt}" decimalPlaces="2" disabled="#{mgSetDetailController.showReadonly()}"/>   
                        </p:column>
                        <p:column>
                            <f:facet name="header">
                                <h:outputText value="最高金額"/>
                            </f:facet>
                            <p:inputNumber size="15" value="#{item.mgActHightAmt}" decimalPlaces="2" disabled="#{mgSetDetailController.showReadonly()}"/>
                        </p:column>
                        <p:column rendered="#{mgSetDetailController.mgActMgRtnRateFlag}">
                            <f:facet name="header">
                                <h:outputText value="經理費率(%)"/>
                            </f:facet>
                            <p:inputNumber size="4" value="#{item.mgActMgRtnRate}" symbol="%" 
                                symbolPosition="s" emptyValue="zero" disabled="#{mgSetDetailController.showReadonly()}"/>
                        </p:column>
                        <p:column>
                            <f:facet name="header">
                                <h:outputText value="費率(bps)"/>
                            </f:facet>
                            <p:inputNumber size="8" value="#{item.mgActBps}" minValue="0.01" maxValue="999.99" disabled="#{mgSetDetailController.showReadonly()}"/>
                        </p:column>
                        <p:column>
                            <f:facet name="header">
                                <h:outputText value="經理費分成(%)"/>
                            </f:facet>
                            <p:inputNumber size="4" value="#{item.mgActMgMapRate}" symbol="%" 
                                symbolPosition="s" emptyValue="zero" disabled="#{mgSetDetailController.showReadonly()}"/>

                        </p:column>
                        <p:column>
                            <f:facet name="header">
                                <h:outputText value="功能"/>
                            </f:facet>

                            <p:commandButton process=":MgSetDetailCreateForm:datalist" icon="ui-icon-minus" value="刪除" 
                                             actionListener="#{mgSetDetailController.minusMSDRC(item)}" 
                                             update=":MgSetDetailCreateForm:datalist" disabled="#{mgSetDetailController.showReadonly()}"/>  
                        </p:column>


                    </p:dataTable>

                    </p:fieldset>

                    <center>

                        <p:commandButton icon="ui-icon-cancel" actionListener="#{mgSetDetailController.cancel()}" value="取消"                                      
                                         oncomplete="PF('MgSetDetailCreateDlg').hide()"
                                         update=":MgSetDetailCreateForm" 
                                         process="@this" />
                        <p:commandButton icon="ui-icon-plus" actionListener="#{mgSetDetailController.create()}" value="送出覆核" 
                                         update=":MgSetDetailCreateForm:dlgMsg :MgSetDetailCreateForm:datalist :MgSetDetailListForm :MgSetDetailListForm:datalist " 
                                         rendered="#{mgSetDetailController.showSend()}" />                
                        
                        <p:commandButton icon="ui-icon-confirm" actionListener="#{mgSetDetailController.confirm('CONFIRM')}" value="同意覆核" 
                                         update=":MgSetDetailCreateForm:dlgMsg :MgSetDetailCreateForm:datalist :MgSetDetailListForm :MgSetDetailListForm:datalist "                                    
                                         rendered="#{mgSetDetailController.showConfirm()}" />
                              
                          <p:commandButton icon="ui-icon-reject" actionListener="#{mgSetDetailController.confirm('REJECT')}" value="退回" 
                                         update=":MgSetDetailCreateForm:dlgMsg :MgSetDetailCreateForm:datalist :MgSetDetailListForm :MgSetDetailListForm:datalist "                                    
                                         rendered="#{mgSetDetailController.showRejectBtn()}" />            
                      



                    </center>
                </p:scrollPanel>
            </h:form>
        </p:dialog>

        <p:dialog id="MgSetProductSettingDlg" widgetVar="MgSetProductSettingDialog" modal="true" resizable="false" appendTo="@(body)" header="產品設定" width="900px">
            <h:form id="MgSetProductSettingForm" prependId="false">
                <p:growl id="settingDlgMsg"/>

                <p:panelGrid style="width: 100%"> 
                    <p:row>
                        <p:column styleClass="ui-widget-header" style="width: 110px">
                            <p:outputLabel value="產品類別" />
                        </p:column>
                        <p:column colspan="3">
                            <p:selectOneMenu  id="productClass" value="#{mgSetDetailController.productVO.productClass}" >                                           
                                <f:selectItem itemLabel="Stock" itemValue="stock" />             
                                <f:selectItem itemLabel="Bond" itemValue="bond" /> 
                                <f:selectItem itemLabel="Fund" itemValue="fund" />                                  
                            </p:selectOneMenu>                         
                        </p:column>
                    </p:row>
                    <p:row>
                        <p:column styleClass="ui-widget-header">
                            <p:outputLabel value="國內/外基金"  />
                        </p:column>
                        <p:column colspan="3">
                            <p:selectOneMenu  id="productAbroad" value="#{mgSetDetailController.productVO.productAbroad}" >                                           
                                <f:selectItem itemLabel="全部" itemValue="all" />           
                                <f:selectItem itemLabel="國內" itemValue="1" />             
                                <f:selectItem itemLabel="國外" itemValue="2" />
                            </p:selectOneMenu>                         
                        </p:column>
                    </p:row>

                    <p:row>
                        <p:column styleClass="ui-widget-header">
                            <p:outputLabel value="系列代碼" for="productSeries" />
                        </p:column>
                        <p:column>
                            <p:selectCheckboxMenu label="系列代碼"  id="productSeries" value="#{mgSetDetailController.productVO.productSeries}" >                                                                                        
                                <f:selectItems value="#{mgSetDetailController.productSeriesList}" var="pSeries" itemLabel="#{pSeries}" itemValue="#{pSeries}" /> 
                                <p:ajax event="change" update=":MgSetProductSettingForm:productType" />
                            </p:selectCheckboxMenu> 

                        </p:column>                            
                        <p:column styleClass="ui-widget-header">
                            <p:outputLabel value="產品類型" for="productType" />
                        </p:column>
                        <p:column>
                            <p:selectCheckboxMenu label="產品類型"  id="productType" value="#{mgSetDetailController.productVO.productType}" >                                                                                        
                                <f:selectItems value="#{mgSetDetailController.productTypeList}" var="pType" itemLabel="#{pType}" itemValue="#{pType}" /> 
                                <p:ajax event="change" update=":MgSetProductSettingForm:" />
                            </p:selectCheckboxMenu> 
                        </p:column>
                    </p:row>
                    <p:row>
                        <p:column styleClass="ui-widget-header">
                            <p:outputLabel value="產品名稱" for="productName" />
                        </p:column>
                        <p:column>
                            <p:inputText id="productName" value="#{mgSetDetailController.productVO.productName}"/>
                        </p:column>                            
                        <p:column styleClass="ui-widget-header">
                            <p:outputLabel value="產品代碼" for="productCode" />
                        </p:column>
                        <p:column>
                            <p:inputText id="productCode" value="#{mgSetDetailController.productVO.productCode}"/>
                        </p:column>
                    </p:row>
                </p:panelGrid>
                <p:spacer height="5px"/>
                <center>
                    <p:commandButton icon="ui-icon-plus" value="查詢" actionListener="#{mgSetDetailController.cancel()}" />    
                </center>
                <hr/>
                <p:panelGrid style="width: 100%"> 
                    <p:row>


                    </p:row>



                </p:panelGrid>



            </h:form>
        </p:dialog>

        <p:dialog id="MgCustActListDlg" widgetVar="MgCustActListDlg" modal="true" resizable="false" appendTo="@(body)" header="名單設定" width="900px">
            <h:form id="MgCustActListForm" prependId="false">
                <p:growl id="MgCustActListDlgMsg"/>


                <p:fileUpload label="選擇檔案" auto="true" fileUploadListener="#{mgSetDetailController.handleFileUpload}" 
                              mode="advanced" dragDropSupport="false"
                              update="idnlist" sizeLimit="100000" fileLimit="3" allowTypes="/(\.|\/)(csv)$/" />

                <p:dataTable id="idnlist" value="#{mgSetDetailController.idnList}" var="item"                             
                             paginator="true"                            
                             rows="10"
                             rowsPerPageTemplate="10,20,30,40,50"
                             paginatorPosition="bottom"
                             emptyMessage="無資料"
                             style="width: 100%">
                    <p:column style="text-align: center">
                        <f:facet name="header">
                            <h:outputText value="IDN"/>
                        </f:facet>
                        <h:outputText value="#{item.custId}"/>
                    </p:column>

                    <p:column style="text-align: center">
                        <f:facet name="header">
                            <h:outputText value="開始日期"/>
                        </f:facet>
                        <h:outputText value="#{item.actStartDt}"/>
                    </p:column>

                    <p:column style="text-align: center">
                        <f:facet name="header">
                            <h:outputText value="結束日期"/>
                        </f:facet>
                        <h:outputText value="#{item.actEndDt}"/>
                    </p:column>
                </p:dataTable>

                <p:commandButton icon="ui-icon-confirm" value="確認" actionListener="#{mgSetDetailController.saveIdn()}"
                                 update=":MgSetDetailCreateForm:dlgMsg :MgSetDetailCreateForm:datalist :MgSetDetailListForm "  
                                 oncomplete="PF('MgCustActListDlg').hide()"
                                 rendered="#{userSession.user.role.equalsIgnoreCase('1')}"/>


            </h:form>
        </p:dialog>

    </ui:composition>
</html>
